import{_ as l,c as h,j as n,a as o,G as a,w as t,ag as r,B as p,o as c}from"./chunks/framework.BDI6Vt0-.js";const f=JSON.parse('{"title":"pythonで音声からの文字起こしを実装する","description":"本稿では，音声データからテキストに変換する文字起こしを実装します．","frontmatter":{"title":"pythonで音声からの文字起こしを実装する","description":"本稿では，音声データからテキストに変換する文字起こしを実装します．","date":"2021-04-09T00:00:00.000Z","category":["Python"],"tags":["Python","Audio","ASR"]},"headers":[],"relativePath":"posts/mojiokoshi.md","filePath":"posts/mojiokoshi.md"}'),k={name:"posts/mojiokoshi.md"};function d(g,s,E,u,y,b){const i=p("CallInArticleAdsense"),e=p("ClientOnly");return c(),h("div",null,[s[0]||(s[0]=n("p",null,[o("本稿では，音声データからテキストに変換する文字起こしを実装します．"),n("br")],-1)),a(e,null,{default:t(()=>[a(i)]),_:1}),s[1]||(s[1]=r(`<p>まだ精神が病んでるので，時にyoutubeで人の話を聞いて，認知療法に役立てているのですが，聞いてから文字に起こすのが面倒くさくなり，実装し始めました．<br> サンプルとして<a href="https://pj.ninjal.ac.jp/corpus_center/csj/sample.html" target="_blank" rel="noreferrer">コーパス開発センター音声・転記テキストサンプル</a>から 学会講演［音声］のサンプル音声(aps-smp.mp3)をダウンロードします．</p><h2 id="事前準備" tabindex="-1">事前準備 <a class="header-anchor" href="#事前準備" aria-label="Permalink to &quot;事前準備&quot;">​</a></h2><p>ここではSpeechRecognitionというモジュールを用いります．googleのAPIを間接的に利用します．<br><a href="https://cloud.google.com/speech-to-text/docs/libraries#client-libraries-install-python" target="_blank" rel="noreferrer">Speech-to-Text 公式API</a></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>pip install SpeechRecognition</span></span>
<span class="line"><span># Successfully installed SpeechRecognition-3.8.1</span></span></code></pre></div><h2 id="音声のファイル変換" tabindex="-1">音声のファイル変換 <a class="header-anchor" href="#音声のファイル変換" aria-label="Permalink to &quot;音声のファイル変換&quot;">​</a></h2><p>サンプルコードでは読み込む拡張子が「.wav」となっているため，mp3 -&gt; wavに変換します．<br> ファイル変換はターミナル上でffmpegで実行します．</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># ffmpegのインストール</span></span>
<span class="line"><span>apt-get install -y ffmpeg</span></span>
<span class="line"><span></span></span>
<span class="line"><span># ファイルの変換</span></span>
<span class="line"><span>ffmpeg -i aps-smp.mp3 aps-smp.wav</span></span></code></pre></div><h2 id="音声のテキスト変換" tabindex="-1">音声のテキスト変換 <a class="header-anchor" href="#音声のテキスト変換" aria-label="Permalink to &quot;音声のテキスト変換&quot;">​</a></h2><p>以下のコードで音声からテキストに変換する文字起こしに実施します．</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 音声のテキスト変換</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> speech_recognition </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sr</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">r </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sr.Recognizer()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">with</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sr.AudioFile(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;aps-smp.wav&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> source:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    audio </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> r.record(source)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">text </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> r.recognize_google(audio, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">language</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;ja-JP&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(text)</span></span></code></pre></div><h2 id="今後のやりたいこと" tabindex="-1">今後のやりたいこと <a class="header-anchor" href="#今後のやりたいこと" aria-label="Permalink to &quot;今後のやりたいこと&quot;">​</a></h2><p>短い音声ファイルではありますが，音声からの文字起こしはできました．<br> 今後は長い動画での文字起こし(できるだけ無料で)に実装したいです．</p><h2 id="参考サイト" tabindex="-1">参考サイト <a class="header-anchor" href="#参考サイト" aria-label="Permalink to &quot;参考サイト&quot;">​</a></h2><ul><li><a href="https://self-development.info/python%E3%81%A7%E9%9F%B3%E5%A3%B0%E3%81%8B%E3%82%89%E3%83%86%E3%82%AD%E3%82%B9%E3%83%88%E3%81%B8%E5%A4%89%E6%8F%9B%E3%80%90speechrecognition%E3%80%91/" target="_blank" rel="noreferrer">Pythonで音声からテキストへ変換</a></li><li><a href="https://qiita.com/seigot/items/62a85f1a561bb820532a" target="_blank" rel="noreferrer">MacでpythonのSpeechRecognitionを使って音声認識</a></li></ul><h2 id="エラーコード" tabindex="-1">エラーコード <a class="header-anchor" href="#エラーコード" aria-label="Permalink to &quot;エラーコード&quot;">​</a></h2><h3 id="エラーコード1" tabindex="-1">エラーコード1 <a class="header-anchor" href="#エラーコード1" aria-label="Permalink to &quot;エラーコード1&quot;">​</a></h3><p>あまりに時間の長い音声ファイル(無料枠から外れる)を変換したり，言語として読み取れなかったりすると，以下のエラーが発生します．<br><a href="https://stackoverflow.com/questions/51757824/recognize-google-speech-recognition-broken-pipe-python" target="_blank" rel="noreferrer">recognize_google speech recognition broken pipe python</a></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>RequestError: recognition connection failed: [Errno 32] Broken pipe</span></span></code></pre></div>`,18)),a(e,null,{default:t(()=>[a(i)]),_:1})])}const _=l(k,[["render",d]]);export{f as __pageData,_ as default};

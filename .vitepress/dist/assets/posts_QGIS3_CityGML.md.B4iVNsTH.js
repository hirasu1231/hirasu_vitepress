import{_ as s,c as l,j as o,G as e,w as n,ag as i,B as p,o as h}from"./chunks/framework.BDI6Vt0-.js";const b=JSON.parse('{"title":"PLATEAUのCityGMLの3D表現を実施します","description":"PLATEAUのCityGMLの3D表現を実施します","frontmatter":{"title":"PLATEAUのCityGMLの3D表現を実施します","description":"PLATEAUのCityGMLの3D表現を実施します","date":"2023-1-27","category":["GIS"],"tags":["GIS","3D","QGIS","PLATEAU","CityGML"]},"headers":[],"relativePath":"posts/QGIS3_CityGML.md","filePath":"posts/QGIS3_CityGML.md"}'),c={name:"posts/QGIS3_CityGML.md"};function d(g,a,f,_,u,k){const t=p("CallInArticleAdsense"),r=p("ClientOnly");return h(),l("div",null,[a[0]||(a[0]=o("p",null,"PLATEAUのCityGMLの3D表現を実施します。",-1)),e(r,null,{default:n(()=>[e(t)]),_:1}),a[1]||(a[1]=i(`<h2 id="citygmlのダウンロード" tabindex="-1">CityGMLのダウンロード <a class="header-anchor" href="#citygmlのダウンロード" aria-label="Permalink to &quot;CityGMLのダウンロード&quot;">​</a></h2><p>下記のサイトでCityGMLのダウンロードを実行します．</p><p><a href="https://www.geospatial.jp/ckan/dataset/plateau" target="_blank" rel="noreferrer">3D都市モデル（Project PLATEAU）東京都23区（CityGML 2020年度）</a></p><p>今回は，渋谷駅周辺(3次メッシュコード「53393596・53393586」)の投影をしてみたいので，2次メッシュコード「533935」のCityGMLをダウンロードします．</p><p><a href="http://gonhana.sakura.ne.jp/tanpopo2015/meshmap/tokyo/533935.html" target="_blank" rel="noreferrer">533935の地図</a>でメッシュコードを確認しています．</p><p>ダウンロードしたファイルは<a href="https://www.geospatial.jp/ckan/dataset/plateau-tokyo23ku-citygml-2020/resource/e5edb01e-8e87-4540-a64e-53dcc0f31f43?inner_span=True" target="_blank" rel="noreferrer">東京23区における3D都市モデルのための拡張製品仕様</a>より，下記のような種類があり，各ファイルで圧縮されています．</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>bldg 建築物、建築物部分、建築物付属物、及びこれらの境界面 </span></span>
<span class="line"><span>tran 道路、通路</span></span>
<span class="line"><span>luse 土地利用</span></span>
<span class="line"><span>urf 都市計画区域、区域区分、地域地区</span></span>
<span class="line"><span>dem 地形(起伏)</span></span>
<span class="line"><span>fld 洪水浸水想定区域</span></span>
<span class="line"><span>tnm 津波浸水想定 </span></span>
<span class="line"><span>lsld 土砂災害警戒区域 </span></span>
<span class="line"><span>brid 橋梁</span></span>
<span class="line"><span>frn 設置物</span></span></code></pre></div><p>今回は建築物を投影したいので，「bldg.7z」を解凍します．</p><p>中に入っているファイルは，3次メッシュコード(53393596 ex)で整理されているGMLファイルです．</p><p>例：53393586_bldg_6697_op2.gml(3次メッシュコード_GMLの種類_日本測地系22011のCRSコード_op2.gml)</p><p>また、appearanceフォルダには建物のテクスチャ（表面画像）が入っています．</p><h2 id="qgisの投影" tabindex="-1">QGISの投影 <a class="header-anchor" href="#qgisの投影" aria-label="Permalink to &quot;QGISの投影&quot;">​</a></h2><h3 id="gmlの投影バグ" tabindex="-1">GMLの投影バグ <a class="header-anchor" href="#gmlの投影バグ" aria-label="Permalink to &quot;GMLの投影バグ&quot;">​</a></h3><p>53393586_bldg_6697_op2.gmlをQGISにドラッグすると，「座標」の表記がXY逆になっていることがわかります．</p><p>本来，X=緯度・Y=経度となるはずが，X=35.63664,Y=139.70695となって逆になっています．</p><h3 id="gmlの投影の修正" tabindex="-1">GMLの投影の修正 <a class="header-anchor" href="#gmlの投影の修正" aria-label="Permalink to &quot;GMLの投影の修正&quot;">​</a></h3><p>その前に生のGMLだといろいろエラーが出ると怖いので、一旦 .gpkg（GeoPackage形式）にして座標のXY入れ替えをします．</p><p>SHPに変換もできなくもないのですが日本語の属性フィールド名ですとSHPがエラーを吐くので、*.gpkgとかのほうがおすすめです．</p><p>「座標のXY入れ替え」は，「プロセッシングメニュー/プロセッシングツールボックス/ベクタジオメトリ/座標のXY入れ替え」を使用します．</p><p>*.gpkgで保存したレイヤーを入力レイヤに選択したら，出力レイヤを入力します．ここではとりあえず，「一時レイヤを作成」でします．</p><h3 id="_3dの投影" tabindex="-1">3Dの投影 <a class="header-anchor" href="#_3dの投影" aria-label="Permalink to &quot;3Dの投影&quot;">​</a></h3><p>QGISの投影法(右下端)をEPSG：6677(JGD2011 平面直角ⅠX系)などのメートル単位の投影法に変更します．</p><p>そして，QGIS2Threejsプラグインなどを使って，建物高さを&quot;measuredHeight&quot;にして３Dにします．</p><p>!(image/3Dsibuya.png)</p><h2 id="まとめ" tabindex="-1">まとめ <a class="header-anchor" href="#まとめ" aria-label="Permalink to &quot;まとめ&quot;">​</a></h2><p>ここまでで，CityGMLの3D表現を実施しました．</p><p>次は，Pythonで自動化もしていきます．</p><h2 id="参考サイト" tabindex="-1">参考サイト <a class="header-anchor" href="#参考サイト" aria-label="Permalink to &quot;参考サイト&quot;">​</a></h2><p><a href="https://www.mlit.go.jp/plateau/" target="_blank" rel="noreferrer">PLATEAU</a></p><p><a href="https://www.mlit.go.jp/plateau/opendata/" target="_blank" rel="noreferrer">PLATEAU Open Data</a></p><p><a href="https://www.geospatial.jp/ckan/dataset/plateau-tokyo23ku-citygml-2020" target="_blank" rel="noreferrer">3D都市モデル（Project PLATEAU）東京都23区（CityGML 2020年度）</a></p><p><a href="https://www.geospatial.jp/ckan/dataset" target="_blank" rel="noreferrer">G空間センター データセット</a></p><p><a href="https://qiita.com/Yfuruchin/items/aa3a847db26c7f378d6e" target="_blank" rel="noreferrer">PLATEAUのCityGMLを鼻血出してQGISで表示する</a></p><p><a href="https://zenn.dev/mugwort_rc/articles/34a427a9394580" target="_blank" rel="noreferrer">QGISでProject PLATEAUのCityGMLの緯度経度が入れ替わる問題を修正した件</a></p><p><a href="https://www.geospatial.jp/ckan/dataset/plateau" target="_blank" rel="noreferrer">3D都市モデル（Project PLATEAU）ポータルサイト(全国版)</a></p><p><a href="https://enjoyworks.jp/tech-blog/7352" target="_blank" rel="noreferrer">3D都市データ”PLATEAU”をPythonで動かしてみよう</a></p><p><a href="https://irukanobox.blogspot.com/2020/01/python.html" target="_blank" rel="noreferrer">Pythonでシェープファイルから都道府県境界図を作成する</a></p><p><a href="http://gonhana.sakura.ne.jp/tanpopo2015/meshmap/tokyo/533935.html" target="_blank" rel="noreferrer">533935の地図</a></p><p><a href="http://www.nilim.go.jp/lab/bcg/siryou/tnn/tnn0574pdf/ks057408.pdf" target="_blank" rel="noreferrer">1次メッシュ 2次メッシュ 3次メッシュ （基準地域メッシュ）</a></p><p><a href="https://erickndava.github.io/hands-on/2018/06/15/when-a-relate-wont-do/" target="_blank" rel="noreferrer">QGISで1対多の「結合」を保存する</a></p><p><a href="https://chiakikun.hatenadiary.com/entry/2018/10/04/235614" target="_blank" rel="noreferrer">QGIS3 GeoPackageの使い方</a></p><p><a href="https://note.com/shinya_hd/n/n8de567cd82a4" target="_blank" rel="noreferrer">Djangoで地図アプリ開発をしよう【前編】</a></p>`,42)),e(r,null,{default:n(()=>[e(t)]),_:1})])}const G=s(c,[["render",d]]);export{b as __pageData,G as default};

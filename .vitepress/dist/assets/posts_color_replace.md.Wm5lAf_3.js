import{_ as e,c as k,j as t,a as p,G as i,w as h,ag as r,B as l,o as E}from"./chunks/framework.BDI6Vt0-.js";const C=JSON.parse('{"title":"Python, OpenCVで指定した色の抽出と別の色への置換を実装する","description":"Python, ESPNetでCityscapesデータセットから人のみを抽出して，仮のオリジナルデータを生成します．","frontmatter":{"title":"Python, OpenCVで指定した色の抽出と別の色への置換を実装する","description":"Python, ESPNetでCityscapesデータセットから人のみを抽出して，仮のオリジナルデータを生成します．","date":"2021-03-21T00:00:00.000Z","category":["Python"],"tags":["Python","OpenCV"]},"headers":[],"relativePath":"posts/color_replace.md","filePath":"posts/color_replace.md"}'),g={name:"posts/color_replace.md"};function d(o,s,y,c,F,m){const a=l("CallInArticleAdsense"),n=l("ClientOnly");return E(),k("div",null,[s[0]||(s[0]=t("p",null,[p("Python, OpenCVで指定した色の抽出と別の色への置換を実装します．"),t("br"),p(" 本稿では，Cityscapesデータセットのカラーマスキング画像の内，人だけを抽出し，白色に置換します．")],-1)),i(n,null,{default:h(()=>[i(a)]),_:1}),s[1]||(s[1]=r(`<h3 id="特定の色を抽出する" tabindex="-1">特定の色を抽出する <a class="header-anchor" href="#特定の色を抽出する" aria-label="Permalink to &quot;特定の色を抽出する&quot;">​</a></h3><p>ここでは特定の色を抽出して，人のマスキングのみを残した画像を作成します．<br> 人のマスキングのRGBは，<a href="https://github.com/mcordts/cityscapesScripts/blob/master/cityscapesscripts/helpers/labels.py" target="_blank" rel="noreferrer">cityscapesScripts/cityscapesscripts/helpers/labels.py</a>よりRGB=(220, 20, 60)となります．<br> 以下のコードではBGRをベースに抽出しています．<br></p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> cv2</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> numpy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> np</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">image </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> cv2.imread(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;color_mask_image.png&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ファイル読み込み</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># bgrでの色抽出</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">bgrLower </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> np.array([</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">60</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">20</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">220</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])    </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 抽出する色の下限(bgr)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">bgrUpper </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> np.array([</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">60</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">20</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">220</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])    </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 抽出する色の上限(bgr)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">img_mask </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> cv2.inRange(image, bgrLower, bgrUpper) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># bgrからマスクを作成</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">extract </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> cv2.bitwise_and(image, image, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">mask</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">img_mask) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 元画像とマスクを合成</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">cv2.imwrite(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;extract.png&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,extract)</span></span></code></pre></div><p>color_mask_image.png<br> !(/image/color_mask_image.png)<br></p><p>extract.png<br> !(/image/extract.png)</p><h3 id="特定の色を別の色に置換する" tabindex="-1">特定の色を別の色に置換する <a class="header-anchor" href="#特定の色を別の色に置換する" aria-label="Permalink to &quot;特定の色を別の色に置換する&quot;">​</a></h3><p>抽出した人のマスキングを特定の色，ここではBGR=(255, 255, 255)に置換します．<br> 以下のコードで実行します．<br></p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> cv2</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> numpy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> np</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">result </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> cv2.imread(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;result.png&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 特定の色を別の色に置換する</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">before_color </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">60</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">20</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">220</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">after_color </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">255</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">255</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">255</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">result[np.where((result </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> before_color).all(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">axis</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> after_color</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">cv2.imwrite(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;replace.png&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,result)</span></span></code></pre></div><p>extract.png<br> !(/image/extract.png)<br></p><p>replace.png<br> !(/image/replace.png)</p><h2 id="参考サイト" tabindex="-1">参考サイト <a class="header-anchor" href="#参考サイト" aria-label="Permalink to &quot;参考サイト&quot;">​</a></h2><p><a href="https://rikoubou.hatenablog.com/entry/2019/02/21/190310" target="_blank" rel="noreferrer">【python/OpenCV】画像の特定の色を抽出する方法</a><br><a href="https://qiita.com/pashango2/items/d6dda5f07109ee5b6163" target="_blank" rel="noreferrer">PIL/Pillowで画像の色を高速に置換する</a><br><a href="http://ni4muraano.hatenablog.com/entry/2017/05/15/000000" target="_blank" rel="noreferrer">【OpenCV】 forループを使わずに指定した色を別の色に変更する</a></p>`,12)),i(n,null,{default:h(()=>[i(a)]),_:1})])}const _=e(g,[["render",d]]);export{C as __pageData,_ as default};
